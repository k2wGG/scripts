// ==UserScript==
// @name          GetUranium AutoBoost v2
// @namespace     https://github.com/k2wGG
// @version       2.9.0
// @description   –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –±—É—Å—Ç–µ—Ä–æ–≤, —Å–±–æ—Ä —Ñ–µ—Ä–º—ã, keep-alive –∏ –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞.
// @author        k2wGG
// @match         https://geturanium.io/*
// @match         https://www.geturanium.io/*
// @run-at        document-start
// @grant         none
// @inject-into   page //–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã
// ==/UserScript==

;(function(){
  'use strict';
  console.info('üöÄ AutoBoost v2.9.0 –∑–∞–≥—Ä—É–∂–µ–Ω.');

  /* ---------------------------------------------------------------
   * 0) –ì–õ–£–ë–û–ö–ò–ï –ü–ê–¢–ß–ò –î–õ–Ø –ò–ú–ò–¢–ê–¶–ò–ò –ê–ö–¢–ò–í–ù–û–°–¢–ò –í –ù–ï–ê–ö–¢–ò–í–ù–û–ô –í–ö–õ–ê–î–ö–ï
   * ------------------------------------------------------------- */
  // 0.1) –ü–∞—Ç—á Event.isTrusted: –î–µ–ª–∞–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è "–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏"
  if(!Event.prototype.__ab_trusted){
    [Event, MouseEvent, KeyboardEvent, UIEvent].forEach(C=>{ // –î–æ–±–∞–≤–ª—è–µ–º UIEvent –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã
      Object.defineProperty(C.prototype,'isTrusted',{
        get(){ return true; },
        configurable:true
      });
    });
    Event.prototype.__ab_trusted = true;
    console.info('[AutoBoost] Event.isTrusted –ø—Ä–æ–ø–∞—Ç—á–µ–Ω: –≤—Å–µ–≥–¥–∞ true');
  }

  // 0.2) –ü–∞—Ç—á requestAnimationFrame (RAF) –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  // –¶–µ–ª—å: —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã RAF, –¥–∞–∂–µ –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞, –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π –∏ –ª–æ–≥–∏–∫–∏.
  // –≠—Ç–æ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞—Ç—å –∫–æ–ª–±—ç–∫, —Ç.–∫. –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å ID.
  if (window.requestAnimationFrame && !window.requestAnimationFrame.__ab_patched) {
    const _originalRequestAnimationFrame = window.requestAnimationFrame;
    const _originalCancelAnimationFrame = window.cancelAnimationFrame;
    const rafCallbacks = new Map(); // –•—Ä–∞–Ω–∏–º –∫–æ–ª–±—ç–∫–∏ –ø–æ –∏—Ö ID
    let nextRafId = 1;

    // –¢–∞–π–º–µ—Ä –¥–ª—è –≤—ã–∑–æ–≤–∞ RAF –∫–æ–ª–±—ç–∫–æ–≤, –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞
    let rafInterval = null;
    const FRAME_RATE_MS = 1000 / 60; // ‚âà 60 –∫–∞–¥—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

    function ensureRafInterval() {
      if (!rafInterval) {
        rafInterval = setInterval(() => {
          if (document.hidden) { // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞, –º—ã —Ñ–æ—Ä—Å–∏—Ä—É–µ–º
            const currentTime = performance.now();
            for (const callback of rafCallbacks.values()) {
              try {
                callback(currentTime);
              } catch (e) {
                console.error('[AutoBoost] –û—à–∏–±–∫–∞ –≤ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º RAF –∫–æ–ª–±—ç–∫–µ:', e);
              }
            }
          }
        }, FRAME_RATE_MS);
      }
    }

    window.requestAnimationFrame = function(callback) {
      const id = nextRafId++;
      rafCallbacks.set(id, callback);
      ensureRafInterval(); // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–ø—É—â–µ–Ω

      // –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π RAF, —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
      // –∏ —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –º–æ–≥ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º, –∫–æ–≥–¥–∞ –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞.
      // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π RAF –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID, –∫–æ—Ç–æ—Ä—ã–π –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è cancelAnimationFrame.
      const originalId = _originalRequestAnimationFrame.call(window, (time) => {
        // –ï—Å–ª–∏ –∫–æ–ª–±—ç–∫ –±—ã–ª –≤—ã–∑–≤–∞–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º RAF, —É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ –Ω–∞—à–µ–π –∫–∞—Ä—Ç—ã
        // –∏ –≤—ã–∑—ã–≤–∞–µ–º –µ–≥–æ, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω –Ω–∞—à–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
        if (rafCallbacks.has(id)) {
            const cb = rafCallbacks.get(id);
            rafCallbacks.delete(id);
            try { cb(time); } catch (e) { console.error('[AutoBoost] –û—à–∏–±–∫–∞ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º RAF –∫–æ–ª–±—ç–∫–µ:', e); }
        }
      });
      // –°–≤—è–∑—ã–≤–∞–µ–º –Ω–∞—à ID —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º ID –¥–ª—è –æ—Ç–º–µ–Ω—ã
      // –≠—Ç–æ —Å–ª–æ–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç, —Ç.–∫. Map —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.
      // –õ—É—á—à–µ: originalId –±—É–¥–µ—Ç –Ω–∞—à ID, –∏ –º—ã –±—É–¥–µ–º –µ–≥–æ –∂–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å.
      rafCallbacks.set(originalId, callback); // –ó–∞–º–µ–Ω–∏–º –Ω–∞—à ID –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π

      return originalId;
    };

    window.cancelAnimationFrame = function(id) {
      if (rafCallbacks.has(id)) {
        rafCallbacks.delete(id);
      }
      _originalCancelAnimationFrame.call(window, id);
      if (rafCallbacks.size === 0 && rafInterval) { // –ï—Å–ª–∏ –Ω–µ—Ç –±–æ–ª—å—à–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö RAF, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
        clearInterval(rafInterval);
        rafInterval = null;
      }
    };

    window.requestAnimationFrame.__ab_patched = true;
    console.info('[AutoBoost] requestAnimationFrame –ø—Ä–æ–ø–∞—Ç—á–µ–Ω –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.');
  }


  // 0.3) –ü–∞—Ç—á setTimeout/setInterval –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ç–∞–π–º–∏–Ω–≥–∞ –≤ —Å–∫—Ä—ã—Ç—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
  // –¶–µ–ª—å: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤ –¥–æ 1 —Å–µ–∫—É–Ω–¥—ã –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö.
  // –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—É—Ç–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –≤ 4–º—Å (—Å—Ç–∞–Ω–¥–∞—Ä—Ç).
  if (!window.__ab_timers_patched) {
    const MIN_INTERVAL_MS = 4; // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ç–∞–π–º–µ—Ä–æ–≤
    const _originalSetTimeout = window.setTimeout;
    const _originalSetInterval = window.setInterval;

    window.setTimeout = function(callback, delay = 0, ...args) {
      return _originalSetTimeout.call(this, callback, Math.max(delay, MIN_INTERVAL_MS), ...args);
    };

    window.setInterval = function(callback, delay = 0, ...args) {
      return _originalSetInterval.call(this, callback, Math.max(delay, MIN_INTERVAL_MS), ...args);
    };
    window.__ab_timers_patched = true;
    console.info('[AutoBoost] setTimeout/setInterval –ø—Ä–æ–ø–∞—Ç—á–µ–Ω—ã –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ç–∞–π–º–∏–Ω–≥–æ–≤.');
  }

  // 0.4) –ü–∞—Ç—á document.hasFocus() –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞
  // –¶–µ–ª—å: –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Å–∞–π—Ç –¥—É–º–∞—Ç—å, —á—Ç–æ –æ–∫–Ω–æ –≤—Å–µ–≥–¥–∞ –≤ —Ñ–æ–∫—É—Å–µ.
  // –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –Ω–µ –º–µ–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ–∫—É—Å–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ,
  // –Ω–æ –æ–±–º–∞–Ω—ã–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ JS –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
  if (document.hasFocus && !document.hasFocus.__ab_patched) {
    const _originalHasFocus = document.hasFocus;
    document.hasFocus = function() {
      // –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º true, —á—Ç–æ–±—ã —Å–∞–π—Ç –¥—É–º–∞–ª, —á—Ç–æ –æ–∫–Ω–æ –≤ —Ñ–æ–∫—É—Å–µ
      return true;
    };
    document.hasFocus.__ab_patched = true;
    console.info('[AutoBoost] document.hasFocus() –ø—Ä–æ–ø–∞—Ç—á–µ–Ω: –≤—Å–µ–≥–¥–∞ true');
  }

  /* ---------------------------------------------------------------
   * 1) –ö–æ–Ω—Ñ–∏–≥ + State (localStorage / sessionStorage)
   * ------------------------------------------------------------- */
  const DEF = {
    enabled:         true,
    autoAC:          true,
    autoSM:          true,
    autoCB:          true,
    autoFarm:        true,
    keepAlive:       true,
    autoReload:      true,
    reloadMinutes:   50,
    logEach:         10
  };
  const LS_CFG    = 'gu-autoboost-config';
  const LS_STATS = 'gu-autoboost-stats';

  let cfg   = loadConfig();
  let stats = loadStats();

  /** –∑–∞–≥—Ä—É–∑–∫–∞ / —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ */
  function loadConfig(){
    try{ return {...DEF, ...JSON.parse(localStorage.getItem(LS_CFG)||'{}')}; }
    catch(e){ console.error('[AutoBoost] –æ—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞',e); return {...DEF}; }
  }
  function saveConfig(){ localStorage.setItem(LS_CFG, JSON.stringify(cfg)); }

  /** –∑–∞–≥—Ä—É–∑–∫–∞ / —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
  function loadStats(){
    try{
      return JSON.parse(sessionStorage.getItem(LS_STATS)) || {
        reloadCount: 0,
        clickCount: { autoAC:0, autoSM:0, autoCB:0, autoFarm:0 }
      };
    }catch(e){
      console.error('[AutoBoost] –æ—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è stats',e);
      return { reloadCount: 0, clickCount:{autoAC:0,autoSM:0,autoCB:0,autoFarm:0} };
    }
  }
  function saveStats(){ sessionStorage.setItem(LS_STATS, JSON.stringify(stats)); }

  /** –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ —á–∏—Å–ª–∞ */
  const rnd = (min,max)=> min + Math.random()*(max-min)|0;

  /* ---------------------------------------------------------------
   * 2) Soft keep-alive ‚Äî –∞–Ω—Ç–∏-AFK (–∏–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π)
   * ------------------------------------------------------------- */
  setInterval(()=>{
    if(!cfg.keepAlive) return;
    // –ò–Ω–∏—Ü–∏–∏—Ä—É–µ–º —Å–µ—Ç–µ–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∏–¥–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
    fetch('/favicon.ico',{cache:'no-store',mode:'no-cors'}).catch(()=>{});

    // –ò–º–∏—Ç–∏—Ä—É–µ–º –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –∏ –∫–ª–∏–∫–∏ (–≤–∞–∂–Ω–æ –¥–ª—è Event.isTrusted)
    const body = document.body;
    if (body) {
      const rect = body.getBoundingClientRect();
      const x = rect.left + Math.random()*rect.width;
      const y = rect.top¬† + Math.random()*rect.height;

      // –ë–æ–ª–µ–µ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
      ['mousemove', 'mousedown', 'mouseup', 'click', 'pointermove'].forEach(type =>
        body.dispatchEvent(new MouseEvent(type, {
          bubbles:true, cancelable:true, view:window,
          button:0, buttons:type==='mousedown'?1:0, // buttons:1 –¥–ª—è mousedown
          clientX:x, clientY:y, isTrusted:true
        }))
      );
    }

    // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    window.scrollBy(0, rnd(-1,1));

    // –ò–º–∏—Ç–∏—Ä—É–µ–º –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à
    document.dispatchEvent(new KeyboardEvent('keydown',{key:' ',code:'Space',bubbles:true, isTrusted:true}));
    document.dispatchEvent(new KeyboardEvent('keyup'¬† ,{key:' ',code:'Space',bubbles:true, isTrusted:true}));

    // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è —Ñ–æ–∫—É—Å–∞/–±–ª—é—Ä–∞ –Ω–∞ document (—Ö–æ—Ç—è document.hasFocus() –ø–∞—Ç—á–∏—Ç—Å—è)
    // –≠—Ç–∏ —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è JS, –∫–æ—Ç–æ—Ä—ã–π –∏—Ö —Å–ª—É—à–∞–µ—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ isTrusted=true.
    document.dispatchEvent(new Event('focus', {bubbles:true, isTrusted:true}));
    document.dispatchEvent(new Event('blur', {bubbles:true, isTrusted:true}));


  }, rnd(90,120)*1000); // –ò–Ω—Ç–µ—Ä–≤–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ 90-120 —Å–µ–∫—É–Ω–¥

  /* ---------------------------------------------------------------
   * 3) –ü–µ—Ä–µ—Ö–≤–∞—Ç fetch ‚Äî 429 / 403
   * ------------------------------------------------------------- */
  let backoffUntil = 0;
  const nativeFetch = window.fetch.bind(window);
  window.fetch = async (...args) => {
    const res = await nativeFetch(...args);
    if(res.status===429){
      backoffUntil = Date.now()+5*60*1000;
      console.warn('[AutoBoost] 429 ‚Üí —Å—Ç–∞–≤–∏–º –ø–∞—É–∑—É 5 –º–∏–Ω');
    }
    if(res.status===403){
      console.warn('[AutoBoost] 403 ‚Üí –∂—ë—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞');
      hardReload();
    }
    return res;
  };

  /* ---------------------------------------------------------------
   * 4) –ê–≤—Ç–æ–∫–ª–∏–∫ –±—É—Å—Ç–µ—Ä–æ–≤ + —Ñ–µ—Ä–º–∞
   * ------------------------------------------------------------- */
  const LABELS = {
    autoAC¬† : 'auto collector',
    autoSM¬† : 'shard multiplier',
    autoCB¬† : 'conveyor booster',
    autoFarm: 'farm reward'
  };
  const timers¬† ¬†= {};
  const lastClick= {};
  const nextLog¬† = { value: Date.now() };

  /** –∏—â–µ–º –∫–Ω–æ–ø–∫—É –ø–æ –Ω–∞—á–∞–ª—É —Ç–µ–∫—Å—Ç–∞ */
  function findBtn(text){
    return [...document.querySelectorAll('button')]
      .find(b => b.innerText.toLowerCase().startsWith(text.toLowerCase()));
  }
  /** –ø–∞—Ä—Å–∏–º –∫—É–ª–¥–∞—É–Ω */
  function getCooldown(btn){
    if(!btn || btn.disabled===false) return 0;
    if(/activating/i.test(btn.innerText)) return 3000;
    const m = /(\d+)\s*m.*?(\d+)\s*s/i.exec(btn.innerText);
    if(m) return (60*+m[1] + +m[2])*1000;
    const s = /(\d+)\s*s/i.exec(btn.innerText);
    if(s) return (+s[1])*1000;
    return 600000;
  }
  /** ¬´—á–µ—Å—Ç–Ω—ã–π¬ª –∫–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É */
  function doClick(el){
    if(!el) return;
    const rect = el.getBoundingClientRect();
    if(!rect.width||!rect.height) return;
    const x = rect.left + Math.random()*rect.width;
    const y = rect.top¬† + Math.random()*rect.height;
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º isTrusted: true, –∫–æ—Ç–æ—Ä–æ–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø–∞—Ç—á–µ–º
    ['mousedown','mouseup','click'].forEach(type=>
      el.dispatchEvent(new MouseEvent(type,{
        bubbles:true,cancelable:true,view:window,
        button:0,buttons:type==='mousedown'?1:0,
        clientX:x,clientY:y,isTrusted:true
      }))
    );
  }

  /** –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∫–ª–∏–∫–æ–≤ */
  function schedule(key){
    clearTimeout(timers[key]);

    if(Date.now()<backoffUntil){
      timers[key] = setTimeout(()=>schedule(key), backoffUntil-Date.now()+1000);
      return;
    }
    if(!cfg.enabled){
      timers[key] = setTimeout(()=>schedule(key), 3000);
      return;
    }

    const btn = findBtn(LABELS[key]);
    const cd¬† = getCooldown(btn);

    if(cd===0){
      const since = Date.now()-(lastClick[key]||0);
      const gap¬† ¬†= 8000 + rnd(0,2000);
      if(cfg[key] && btn && !btn.disabled && since>gap){
        doClick(btn);
        lastClick[key] = Date.now();
        stats.clickCount[key]++; saveStats(); updateStatsUI();
        log(`‚ö° ${key}`);
      }
      timers[key] = setTimeout(()=>schedule(key),1000);
    }else{
      const delay = cd + 1000 + rnd(0,1500);
      log(`‚è≥ ${key}: ${Math.round(cd/1000)} —Å`);
      timers[key] = setTimeout(()=>schedule(key), delay);
    }
  }
  /** –∑–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ (–∫—Ä–æ–º–µ —Ñ–µ—Ä–º—ã) */
  function startAll(){
    Object.keys(LABELS).forEach(key=> key!=='autoFarm' && schedule(key));
  }

  /* ---------------------------------------------------------------
   * 5) –ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤–∫–ª–∞–¥–∫–∏
   * ------------------------------------------------------------- */
  let reloadTimer = null;
  function scheduleReload(){
    clearTimeout(reloadTimer);
    if(!cfg.autoReload) return;
    const ms = cfg.reloadMinutes*60*1000;
    console.info(`[AutoBoost] —Å–ª–µ–¥—É—é—â–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ ${cfg.reloadMinutes} –º–∏–Ω`);
    reloadTimer = setTimeout(()=>{
      stats.reloadCount++; saveStats(); updateStatsUI();
      hardReload();
    }, ms);
  }
  function hardReload(){
    location.replace(location.pathname+'?_='+Date.now());
  }

  /* ---------------------------------------------------------------
   * 6) keep-alive –¥–ª—è Vercel (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ edge-—Ñ—É–Ω–∫—Ü–∏–π)
   * ------------------------------------------------------------- */
  function scheduleVercel(){
    if(!cfg.keepAlive) return;
    const ms = rnd(50,55)*60*1000;
    console.info(`[AutoBoost] ping Vercel —á–µ—Ä–µ–∑ ‚âà${Math.round(ms/60000)} –º–∏–Ω`);
    setTimeout(()=>{
      const f=document.createElement('iframe');
      f.style.display='none'; f.src='/';
      document.body.append(f);
      setTimeout(()=>f.remove(),15000);
      scheduleVercel();
    }, ms);
  }

  /* ---------------------------------------------------------------
   * 7) –ê–≤—Ç–æ-—Ñ–µ—Ä–º–∞ —Ä–∞–∑ –≤ 8 —á–∞—Å–æ–≤
   * ------------------------------------------------------------- */
  let farmInterval = null;
  function doFarm(){
    if(!cfg.autoFarm) return;
    const b = findBtn(LABELS.autoFarm);
    if(b && !b.disabled){
      doClick(b);
      stats.clickCount.autoFarm++; saveStats(); updateStatsUI();
      console.info('[AutoBoost] üåæ –∫–ª–∏–∫ –ø–æ —Ñ–µ—Ä–º–µ');
    }
  }
  function scheduleFarm(){
    clearInterval(farmInterval);
    if(!cfg.autoFarm) return;
    doFarm();
    farmInterval = setInterval(doFarm, 8*60*60*1000 + rnd(0,5*60*1000));
  }

  /* ---------------------------------------------------------------
   * 8) –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   * ------------------------------------------------------------- */
  function init(){
    /* UI —É–∂–µ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω –≤ waitBody ‚Üí –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ-–∫–ª–∏–∫ */
    if(!findBtn(LABELS.autoAC) && !findBtn(LABELS.autoSM) && !findBtn(LABELS.autoCB)){
      requestAnimationFrame(init);¬† ¬† ¬† ¬† ¬† // –∂–¥—ë–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫
      return;
    }
    console.info('‚úÖ AutoBoost –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
    startAll();
    scheduleReload();
    scheduleVercel();
    scheduleFarm();
  }

  /* ---------------------------------------------------------------
   * 9) –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã
   * ------------------------------------------------------------- */
  function log(msg){
    if(!cfg.logEach) return;
    const now = Date.now();
    if(now >= nextLog.value){
      console.log(`[AutoBoost] ${msg}`);
      nextLog.value = now + cfg.logEach*1000;
    }
  }

  /* ---------------------------------------------------------------
   * 10) UI + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   * ------------------------------------------------------------- */
  let updateStatsUI = ()=>{};¬† ¬†// –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
  function renderUI(){
    if(document.querySelector('.gu-gear')) return;¬† ¬† ¬† ¬†// –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º

    const css = `
      .gu-gear{
        position:fixed;top:12px;right:12px;width:36px;height:36px;
        background:#1b1b25dd;border-radius:50%;display:flex;
        align-items:center;justify-content:center;cursor:pointer;
        z-index:9999;color:#8cf;font-size:20px;user-select:none}
      .gu-gear:hover{transform:rotate(45deg)}
      .gu-panel{
        position:fixed;top:56px;right:12px;width:340px;background:#1b1b25f2;
        padding:12px;border-radius:8px;font:13px/1.4 sans-serif;color:#cee;
        box-shadow:0 4px 8px rgba(0,0,0,.3)}
      .gu-panel hr{border-color:#444;margin:8px 0}
      .gu-panel .row{display:flex;align-items:center;justify-content:space-between;margin:4px 0}
      .gu-panel .row label{flex:1;margin-right:8px;cursor:pointer}
      .gu-panel input[type=number]{width:60px;background:#111;color:#fee;
        border:1px solid #555;border-radius:4px;text-align:center}
      .gu-panel button{width:100%;margin-top:8px;padding:6px 0;background:#444;border:none;
        border-radius:4px;color:#eee;cursor:pointer;transition:background-color .2s}
      .gu-panel button:hover{background:#555}
      .stat-value{font-weight:bold;color:#4caf50}`;
    const html = `
      <div class="gu-gear">‚öôÔ∏è</div>
      <div class="gu-panel" style="display:none">
        <div class="row"><label><input id="gu-enabled" type="checkbox"> –í–∫–ª—é—á–∏—Ç—å –≤—Å—ë</label></div><hr/>
        <div class="row"><label><input id="gu-ac" type="checkbox"> Auto Collector</label></div>
        <div class="row"><label><input id="gu-sm" type="checkbox"> Shard Multiplier</label></div>
        <div class="row"><label><input id="gu-cb" type="checkbox"> Conveyor Booster</label></div><hr/>
        <div class="row"><label><input id="gu-farm" type="checkbox"> Auto Farm (8 —á)</label></div><hr/>
        <div class="row"><label><input id="gu-ka" type="checkbox"> Keep-Alive</label></div>
        <div class="row"><label><input id="gu-reload" type="checkbox"> Auto Reload</label></div>
        <div class="row"><label>–ò–Ω—Ç–µ—Ä–≤–∞–ª (–º–∏–Ω)</label><input id="gu-reload-min" type="number" min="1"></div><hr/>
        <div class="row"><label>–õ–æ–≥ –∫–∞–∂–¥—ã–µ (—Å)</label><input id="gu-log" type="number" min="0"></div><hr/>
        <div class="row"><label>–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫</label><div id="st-rel" class="stat-value">0</div></div>
        <div class="row"><label>Collector</label><div id="st-ac" class="stat-value">0</div></div>
        <div class="row"><label>Shard</label><div id="st-sm" class="stat-value">0</div></div>
        <div class="row"><label>Booster</label><div id="st-cb" class="stat-value">0</div></div>
        <div class="row"><label>Farm</label><div id="st-farm" class="stat-value">0</div></div><hr/>
        <button id="gu-reset">–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
      </div>`;
    document.head.insertAdjacentHTML('beforeend',`<style>${css}</style>`);
    document.body.insertAdjacentHTML('beforeend',html);

    const $ = s=>document.querySelector(s);
    const gear¬† = $('.gu-gear');
    const panel = $('.gu-panel');

    updateStatsUI = ()=>{
      $('#st-rel').textContent¬† = stats.reloadCount;
      $('#st-ac').textContent¬† ¬†= stats.clickCount.autoAC;
      $('#st-sm').textContent¬† ¬†= stats.clickCount.autoSM;
      $('#st-cb').textContent¬† ¬†= stats.clickCount.autoCB;
      $('#st-farm').textContent = stats.clickCount.autoFarm;
    };

    /** —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤ –∏ –ø–æ–ª–µ–π */
    function syncUI(){
      $('#gu-enabled').checked¬† ¬† ¬† = cfg.enabled;
      $('#gu-ac').checked¬† ¬† ¬† ¬† ¬† ¬†= cfg.autoAC;
      $('#gu-sm').checked¬† ¬† ¬† ¬† ¬† ¬†= cfg.autoSM;
      $('#gu-cb').checked¬† ¬† ¬† ¬† ¬† ¬†= cfg.autoCB;
      $('#gu-farm').checked¬† ¬† ¬† ¬† ¬†= cfg.autoFarm;
      $('#gu-ka').checked¬† ¬† ¬† ¬† ¬† ¬†= cfg.keepAlive;
      $('#gu-reload').checked¬† ¬† ¬† ¬†= cfg.autoReload;
      $('#gu-reload-min').value¬† ¬† ¬†= cfg.reloadMinutes;
      $('#gu-log').value¬† ¬† ¬† ¬† ¬† ¬† = cfg.logEach;
      updateStatsUI();
    }
    syncUI();

    /* –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è */
    $('#gu-enabled').onchange¬† ¬† ¬†= e=>{ cfg.enabled¬† ¬† ¬† ¬†= e.target.checked; saveConfig(); startAll(); };
    $('#gu-ac').onchange¬† ¬† ¬† ¬† ¬† = e=>{ cfg.autoAC¬† ¬† ¬† ¬† = e.target.checked; saveConfig(); };
    $('#gu-sm').onchange¬† ¬† ¬† ¬† ¬† = e=>{ cfg.autoSM¬† ¬† ¬† ¬† = e.target.checked; saveConfig(); };
    $('#gu-cb').onchange¬† ¬† ¬† ¬† ¬† = e=>{ cfg.autoCB¬† ¬† ¬† ¬† = e.target.checked; saveConfig(); };
    $('#gu-farm').onchange¬† ¬† ¬† ¬† = e=>{ cfg.autoFarm¬† ¬† ¬† = e.target.checked; saveConfig(); scheduleFarm(); };
    $('#gu-ka').onchange¬† ¬† ¬† ¬† ¬† = e=>{ cfg.keepAlive¬† ¬† ¬†= e.target.checked; saveConfig(); };
    $('#gu-reload').onchange¬† ¬† ¬† = e=>{ cfg.autoReload¬† ¬† = e.target.checked; saveConfig(); scheduleReload(); };
    $('#gu-reload-min').onchange¬† = e=>{ cfg.reloadMinutes = Math.max(1,~~e.target.value); saveConfig(); scheduleReload(); };
    $('#gu-log').onchange¬† ¬† ¬† ¬† ¬†= e=>{ cfg.logEach¬† ¬† ¬† ¬†= Math.max(0,~~e.target.value); saveConfig(); };

    $('#gu-reset').onclick = ()=>{
      Object.assign(cfg,DEF);
      stats = { reloadCount:0, clickCount:{autoAC:0,autoSM:0,autoCB:0,autoFarm:0} };
      saveConfig(); saveStats(); syncUI(); startAll(); scheduleFarm(); console.clear();
    };

    /* –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏ ‚Äî –±–µ–∑ return-assign */
    gear.onclick = () => {
      panel.style.display = panel.style.display==='none' ? 'block' : 'none';
    };
  }

  /* ---------------------------------------------------------------
   * 11) –†–∏—Å—É–µ–º UI —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è <body>
   * ------------------------------------------------------------- */
  const waitBody = fn => document.body ? fn() : setTimeout(()=>waitBody(fn),50);
  waitBody(renderUI);
  setInterval(()=> !document.querySelector('.gu-gear') && renderUI(), 10000);

  /* ---------------------------------------------------------------
   * 12) –°—Ç–∞—Ä—Ç —Å–∫—Ä–∏–ø—Ç–∞
   * ------------------------------------------------------------- */
  if(document.readyState==='complete') init();
  else window.addEventListener('load', init, { once:true });

  /* –Ω–∞–±–ª—é–¥–∞–µ–º –∑–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ DOM */
  new MutationObserver(m=> m.some(x=>x.type==='childList') && startAll())
    .observe(document.documentElement,{childList:true,subtree:true});

})();
