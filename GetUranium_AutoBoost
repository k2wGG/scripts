// ==UserScript==
// @name         GetUraniumÂ AutoBoostÂ v2Â (UIâ€‘edition)
// @namespace    https://github.com/k2wGG
// @version      2.1
// @description  ĞĞ²Ñ‚Ğ¾Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ‚Ñ€Ñ‘Ñ… Ğ±ÑƒÑÑ‚ĞµÑ€Ğ¾Ğ² +Â ÑˆĞµÑÑ‚ĞµÑ€Ñ‘Ğ½ĞºĞ°â€‘GUI Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ½ĞºĞ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
// @match        https://www.geturanium.io/*
// @run-at       document-end
// @grant        none
// ==/UserScript==

/*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  0. Bootstrap &Â helpers  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
(function () {
  'use strict';
  console.log('ğŸš€ AutoBoost v2 (UI) loaded');

  /* 0.1 Â«Ğ“Ğ»ÑƒÑˆĞ¸Ğ¼Â»Â isTrustedÂ â€” React Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ syntheticâ€‘click */
  [Event, MouseEvent].forEach(C =>
    Object.defineProperty(C.prototype, 'isTrusted', {
      get() { return true; }, configurable: true
    })
  );

  /* 0.2 DefaultsÂ +Â storage */
  const DEF = {
    enabled : true,
    autoAC  : true,
    autoSM  : true,
    autoCB  : true,
    logEach : 10          // ÑĞµĞº; 0Â â€” Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ»Ğ¾Ğ³Ğ¸
  };
  const LS_KEY = 'guâ€‘autoboost';
  const cfg = load();

  function load(){
    try{ return {...DEF, ...JSON.parse(localStorage.getItem(LS_KEY)||'{}')};}
    catch(e){ return {...DEF};}
  }
  function save(){ localStorage.setItem(LS_KEY,JSON.stringify(cfg)); }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  1. ĞŸĞ¾Ğ¸ÑĞº Ğ¸Â ĞºĞ»Ğ¸Ğº  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  const LABEL = {
    autoAC:'auto collector',
    autoSM:'shard multiplier',
    autoCB:'conveyor booster'
  };

  const timers = {};             // {flag: timeoutID}
  const nextLog = {value: Date.now()};

  function findBtn(flag){
    const lbl = LABEL[flag];
    return [...document.querySelectorAll('button')]
           .find(b=>b.innerText.toLowerCase().startsWith(lbl));
  }

  function getRestMs(btn){
    if(!btn || !btn.disabled) return 0;
    const m=/(\d+)\s*m.*?(\d+)\s*s/.exec(btn.innerText);
    if(m) return (60*+m[1]+ +m[2])*1000;
    return 600_000;              // fallback 10Â Ğ¼Ğ¸Ğ½
  }

  function simulateClick(el){
    ['mousedown','mouseup','click'].forEach(type=>
      el.dispatchEvent(new MouseEvent(type,{bubbles:true,cancelable:true,view:window}))
    );
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  2. ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  function schedule(flag){
    clearTimeout(timers[flag]);
    if(!cfg.enabled){                       // ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½
      timers[flag]=setTimeout(()=>schedule(flag),3000);
      return;
    }

    const btn  = findBtn(flag);
    const rest = getRestMs(btn);

    if(rest===0){                           // Ğ±ÑƒÑÑ‚ĞµÑ€ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½
      if(cfg[flag] && btn && !btn.disabled){
        simulateClick(btn);
        log(`âš¡ click "${flag}"`);
      }
      timers[flag]=setTimeout(()=>schedule(flag),1000);
      return;
    }

    log(`â³ ${flag}: ${Math.round(rest/1000)}Â s left`);
    timers[flag]=setTimeout(()=>schedule(flag),rest+1000);
  }

  function startAll(){ Object.keys(LABEL).forEach(schedule); }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  3. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  function init(){
    if(!findBtn('autoAC')){ requestAnimationFrame(init); return;}
    console.log('âœ… AutoBoost initialised');
    startAll();
  }
  init();

  /* Ğ¿ĞµÑ€ĞµÑÑ‡Ñ‘Ñ‚ Ğ¿Ñ€Ğ¸ Ğ»ÑĞ±Ğ¾Ğ¼ Ğ¿ĞµÑ€ĞµÑ€ĞµĞ½Ğ´ĞµÑ€Ğµ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº */
  const ob=new MutationObserver(muts=>{
    if(muts.some(m=>m.type==='childList')) startAll();
  });
  ob.observe(document.documentElement,{childList:true,subtree:true});

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  4. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  function log(str){
    if(!cfg.logEach) return;                             // Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾
    const now=Date.now();
    if(now>=nextLog.value){
      console.log(`[AutoBoost] ${str}`);
      nextLog.value=now+cfg.logEach*1000;
    }
  }

  /*â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  5. GUI (ÑˆĞµÑÑ‚ĞµÑ€Ñ‘Ğ½ĞºĞ°)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
  (function injectUI(){
    if(document.querySelector('.guâ€‘gear')) return;       // ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ

    document.body.insertAdjacentHTML('beforeend',`
<style>
.guâ€‘gear{position:fixed;top:12px;right:12px;width:36px;height:36px;
         background:#1b1b25dd;border-radius:50%;display:flex;align-items:center;
         justify-content:center;cursor:pointer;z-index:2147483647;
         color:#8cf;font-size:20px;user-select:none}
.guâ€‘panel{position:fixed;top:56px;right:12px;width:230px;background:#1b1b25f2;
          padding:12px 14px;border-radius:8px;font:13px/1.4 sans-serif;
          color:#cee;box-shadow:0 4px 12px #000b;z-index:2147483647;
          backdrop-filter:blur(4px)}
.guâ€‘panel hr{border-color:#444;margin:6px -14px}
.guâ€‘panel input[type=number]{width:60px;margin-left:4px;background:#111;
          color:#fee;border:1px solid #555;border-radius:4px;padding:2px 4px}
.guâ€‘panel label{display:block;margin:5px 0}
.guâ€‘panel button{margin-top:6px;padding:2px 8px;background:#444;border:0;
          border-radius:4px;color:#eee;cursor:pointer}
</style>

<div class="guâ€‘gear" title="AutoBoost settings">âš™ï¸</div>
<div class="guâ€‘panel" style="display:none">
  <label><input type="checkbox" id="guâ€‘enabled"> script enabled</label><hr>
  <label><input type="checkbox" id="guâ€‘ac"> Autoâ€¯Collector</label>
  <label><input type="checkbox" id="guâ€‘sm"> Shardâ€¯Multiplier</label>
  <label><input type="checkbox" id="guâ€‘cb"> Conveyorâ€¯Booster</label><hr>
  log each <input type="number" id="guâ€‘log" min="0" step="1">Â s
  <button id="guâ€‘reset">reset</button>
</div>`);

    const $ = s=>document.querySelector(s),
          gear = $('.guâ€‘gear'),
          pnl  = $('.guâ€‘panel');

    /* ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµĞºĞ±Ğ¾ĞºÑĞ¾Ğ²/Ğ¿Ğ¾Ğ»ĞµĞ¹ */
    function sync(){
      $('#guâ€‘enabled').checked=cfg.enabled;
      $('#guâ€‘ac').checked     =cfg.autoAC;
      $('#guâ€‘sm').checked     =cfg.autoSM;
      $('#guâ€‘cb').checked     =cfg.autoCB;
      $('#guâ€‘log').value      =cfg.logEach;
    }
    sync();

    $('#guâ€‘enabled').onchange=e=>{cfg.enabled=e.target.checked;save();startAll();};
    $('#guâ€‘ac').onchange   =e=>{cfg.autoAC =e.target.checked;save();startAll();};
    $('#guâ€‘sm').onchange   =e=>{cfg.autoSM =e.target.checked;save();startAll();};
    $('#guâ€‘cb').onchange   =e=>{cfg.autoCB =e.target.checked;save();startAll();};
    $('#guâ€‘log').onchange  =e=>{cfg.logEach=Math.max(0,~~e.target.value);save();};
    $('#guâ€‘reset').onclick =()=>{
      Object.assign(cfg,DEF); save(); sync(); startAll(); console.clear();
    };

    const toggle=()=>pnl.style.display=pnl.style.display==='none'?'block':'none';
    gear.onclick=toggle;
    window.addEventListener('keydown',e=>{
      if(e.altKey && e.key.toLowerCase()==='g'){ e.preventDefault(); toggle(); }
    });
  })();

})();   /* === END SCRIPT === */
